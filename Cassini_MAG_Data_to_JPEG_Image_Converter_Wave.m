% Supplementary material to Suranga Ruhunusiri, "Identification of Plasma waves at Saturn 
% Using Convolutional Neural Networks", to be published in IEEE Transactions on Plasma Science, 2018.

% This program has been tested with MATLAB R2017a on Windows 10.

% This program generates 1D 8-bit RGB JPEG images from Cassini time series data for
% CNN training, validation and testing. This code was specifically used to generate
% JPEG images containing wave packets similar to the ones in the folder
% "CNN_TVT/waves/" provided with the repository.

% Before executing this program, the user should load Cassini MAG data to 
% the MATLAB workspace (for example load Mag_1s_data_2004_Nov_08_to_Nov_09.mat provide with this repository)
% and specify INPUT1-INPUT7 below.

%INPUT1:train_folder 
%location to save the wave image set
image_folder = 'C:\Cassini\CNN_TVT\wave\';

%INPUT2:st_fil
% variable for specifying the start index for image file name. 
% If you want to start the file name index with 1 use the default value of 0.
st_fil=0; 
             
%INPUT3:SDate
%Matrix of start times for the waves of interest
%The following example times are specified assuming that Mag_1s_data_2004_Nov_08_to_Nov_09.mat has
%been loaded into the MATLAB workspace
SDate = [   [2004,11,8,2,32,0];...  
            [2004,11,8,10,9,30];...
            [2004,11,8,11,24,30];...
            [2004,11,8,17,45,30];...
            [2004,11,8,20,37,30];...
            [2004,11,9,10,12,30];...
            [2004,11,9,15,9,30];...
            [2004,11,9,15,20,0];...
            [2004,11,9,15,50,30];...
            [2004,11,9,18,50,0];...
            [2004,11,9,19,28,0];...
            [2004,11,9,22,13,30];...
            [2004,11,9,23,42,30];...
            [2004,11,8,21,13,0];... 
            [2004,11,8,21,59,0];... 
            [2004,11,9,13,59,50];...
            [2004,11,9,20,23,0];... 
            [2004,11,9,21,7,50];... 
            [2004,11,9,23,9,0];...  
            [2004,11,9,23,31,0];... 
            ];
            
%INPUT4:EDate     
%Matrix of end times for the waves of interest
%The following times are specified assuming that Mag_1s_data_2004_Nov_08_to_Nov_09.mat has
%been loaded into the MATLAB workspace
EDate = [   [2004,11,8,2,34,0];... 
            [2004,11,8,10,11,30];...
            [2004,11,8,11,26,30];...
            [2004,11,8,17,47,30];...
            [2004,11,8,20,39,30];... 
            [2004,11,9,10,14,30];...
            [2004,11,9,15,11,30];...
            [2004,11,9,15,22,0];...
            [2004,11,9,15,52,30];...
            [2004,11,9,18,52,0];...
            [2004,11,9,19,30,0];...
            [2004,11,9,22,15,30];...
            [2004,11,9,23,44,30];...
            [2004,11,8,21,15,0];... 
            [2004,11,8,22,1,0];...  
            [2004,11,9,14,1,50];...  
            [2004,11,9,20,25,0];...  
            [2004,11,9,21,9,50];...  
            [2004,11,9,23,11,0];...  
            [2004,11,9,23,33,0];...  
             
            ];
        
    num_wav = length(SDate(:,1));
        holder  =zeros(1,num_wav);
        
        
        
for i=1:num_wav
            
    row_select = i;
        
    start_date = datenum(SDate(row_select,1),SDate(row_select,2),SDate(row_select,3),SDate(row_select,4),SDate(row_select,5),SDate(row_select,6));
    end_date = datenum(EDate(row_select,1),EDate(row_select,2),EDate(row_select,3),EDate(row_select,4),EDate(row_select,5),EDate(row_select,6));

    indices = find(Date_num > start_date & Date_num < end_date); 
    
    Date_now = Date_num(indices,1);
    Bx_now = Bx(indices,1);
    By_now = By(indices,1);
    Bz_now = Bz(indices,1);
    Bmag_now = B_mag(indices,1);

    rgb_pic=zeros(1,120,3);
     Bx_now = transpose(Bx_now);
     Bz_now = transpose(Bz_now);
    By_now = transpose(By_now);

     Wave_now_x = Bx_now-min(Bx_now);
    Wave_now_x = Wave_now_x/max(Wave_now_x);
 
    Wave_now_y = By_now-min(By_now);
    Wave_now_y = Wave_now_y/max(Wave_now_y);
 
    Wave_now_z = Bz_now-min(Bz_now);
    Wave_now_z = Wave_now_z/max(Wave_now_z);
 
    if length(Wave_now_x) == 120 && length(Wave_now_y) == 120 && length(Wave_now_z) == 120
    
        rgb_pic(:,:,1) =  Wave_now_x;
        rgb_pic(:,:,2) =  Wave_now_y;
        rgb_pic(:,:,3) =  Wave_now_z;
    
        file_ex = char(strcat(image_folder,'wave',string(i+st_fil),'.jpg'));

        imwrite(rgb_pic,file_ex);
    end

    

end

clearvars -except Bx By Bz B_mag Date_num;